---
title: "Exploratory Data Analysis"
author: "Haley Roberts, Sam Pastoriza, Monroe Farris"
date: "12/05/2021"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

\pagenumbering{gobble}

```{r setup, include=FALSE}
# For the full source code, see https://github.com/pastorsj/511FinalProject
knitr::opts_chunk$set(echo = TRUE)
if (!require("pacman")) {
  install.packages("pacman")
}

pacman::p_load(tidyverse, ggplot2, ggthemes, gganimate, gifski, 
               png, htmlwidgets, orca, plotly, gridExtra)
Sys.setenv("PATH" = paste(Sys.getenv("PATH"), "/usr/local/anaconda3/bin", sep = .Platform$path.sep))
```

## Prepare the data

```{r}
# Read in the cleaned data
df <- read.csv('data/finalCleanedData.csv')
single.out.colleges <- c('Georgetown University', 
                         'Rose-Hulman Institute of Technology', 
                         'Georgia Institute of Technology-Main Campus', 
                         'University of Virginia-Main Campus', 
                         'University of Phoenix-Arizona')
admission.year <- '2014_15'
graduation.year <- '2017_18'

# Filter out columns that were not statistically significant
df <- df %>% 
  select(-X, 
         -Unnamed..0, 
         -Predominantly.Black, 
         -Percent.of.Students..White., 
         -Percent.of.Students..Hispanic., 
         -Percent.of.Students..Asian., 
         -Percent.of.Students..Black., 
         -Most.Awarded.Degree) %>%
  transform(Color = ifelse(University.Name %in% single.out.colleges, 
                           'Single', 
                           'Normal')) %>%
  transform(Color = as.factor(Color),
            Year = as.factor(Year),
            University.State = as.factor(University.State))
# Preview of the data
head(df)
# Columns
names(df)
```

# Basic
## Boxplots and Histograms
### Average SAT Scores over time
```{r}
df.clean.sat <- df %>%
  drop_na(SAT.Average)
write.csv(df.clean.sat, 'data/cleaned_sat_scores.csv', row.names = FALSE)

par(mfrow = c(2,3))
# Side by side distribution over time
score <- df.clean.sat[df.clean.sat$Year == '2014_15',]$SAT.Average
hist(score, col = 'orange', xlab = paste('SAT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'SAT Score (2014 - 2015)', xlim=c(600, 1600))
abline(v = mean(score), col = "red", lwd = 2)

score <- df.clean.sat[df.clean.sat$Year == '2015_16',]$SAT.Average
hist(score, col = 'cyan', xlab = paste('SAT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'SAT Score (2015 - 2016)', xlim=c(600, 1600))
abline(v = mean(score), col = "red", lwd = 2)

score <- df.clean.sat[df.clean.sat$Year == '2016_17',]$SAT.Average
hist(score, col = 'green', xlab = paste('SAT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'SAT Score (2016 - 2017)', xlim=c(600, 1600))
abline(v = mean(score), col = "red", lwd = 2)

score <- df.clean.sat[df.clean.sat$Year == '2017_18',]$SAT.Average
hist(score, col = 'blue', xlab = paste('SAT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'SAT Score (2017 - 2018)', xlim=c(600, 1600))
abline(v = mean(score), col = "red", lwd = 2)

score <- df.clean.sat[df.clean.sat$Year == '2018_19',]$SAT.Average
hist(score, col = 'magenta', xlab = paste('SAT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'SAT Score (2018 - 2019)', xlim=c(600, 1600))
abline(v = mean(score), col = "red", lwd = 2)

score <- df.clean.sat[df.clean.sat$Year == '2019_20',]$SAT.Average
hist(score, col = 'gold', xlab = paste('SAT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'SAT Score (2019 - 2020)', xlim=c(600, 1600))
abline(v = mean(score), col = "red", lwd = 2)
dev.copy(png, filename = 'visualizations/sat_score_histogram.png', width = 1400, height = 865, res = 200)
dev.off()
```

Here we can see the SAT score slowly increase over time until 2017, where they rise dramatically. This is in part to the change of the SAT scale. Originally, the scale was scores ranging up to 2400, however, now the scale is only up to 1600.

```{r}
par(mfrow = c(2,3))
# Side by side distribution over time
boxplot(df.clean.sat[df.clean.sat$Year == '2014_15',]$SAT.Average, col = 'orange', 
        xlab = 'SAT Score', main = 'Average SAT (2014 - 2015)')
boxplot(df.clean.sat[df.clean.sat$Year == '2015_16',]$SAT.Average, col = 'red', 
        xlab = 'SAT Score', main = 'Average SAT (2015 - 2016)')
boxplot(df.clean.sat[df.clean.sat$Year == '2016_17',]$SAT.Average, col = 'green', 
        xlab = 'SAT Score', main = 'Average SAT (2016 - 2017)')
boxplot(df.clean.sat[df.clean.sat$Year == '2017_18',]$SAT.Average, col = 'blue', 
        xlab = 'SAT Score', main = 'Average SAT (2017 - 2018)')
boxplot(df.clean.sat[df.clean.sat$Year == '2018_19',]$SAT.Average, col = 'magenta', 
        xlab = 'SAT Score', main = 'Average SAT (2018 - 2019)')
boxplot(df.clean.sat[df.clean.sat$Year == '2019_20',]$SAT.Average, col = 'gold', 
        xlab = 'SAT Score', main = 'Average SAT (2019 - 2020)')
dev.copy(png, filename = 'visualizations/sat_score_boxplot.png', , width = 1400, height = 865, res = 200)
dev.off()
```

Here the distribution of SAT scores is fairly regular with a couple of outliers, but for the most part, the distribution is mundane.

### Average ACT Scores over time
```{r}
df.clean.act <- df %>%
  drop_na(ACT.Cumulative.Average)
write.csv(df.clean.act, 'data/cleaned_act_scores.csv', row.names = FALSE)

par(mfrow = c(2,3))
# Side by side distribution over time
score <- df.clean.act[df.clean.act$Year == '2014_15',]$ACT.Cumulative.Average
hist(score, col = 'orange', xlab = paste('ACT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'ACT Score (2014 - 2015)', xlim=c(10, 36))
abline(v = mean(score), col = "red", lwd = 2)

score <- df.clean.act[df.clean.act$Year == '2015_16',]$ACT.Cumulative.Average
hist(score, col = 'cyan', xlab = paste('ACT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'ACT Score (2015 - 2016)', xlim=c(10, 36))
abline(v = mean(score), col = "red", lwd = 2)

score <- df.clean.act[df.clean.act$Year == '2016_17',]$ACT.Cumulative.Average
hist(score, col = 'green', xlab = paste('ACT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'ACT Score (2016 - 2017)', xlim=c(10, 36))
abline(v = mean(score), col = "red", lwd = 2)

score <- df.clean.act[df.clean.act$Year == '2017_18',]$ACT.Cumulative.Average
hist(score, col = 'blue', xlab = paste('ACT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'ACT Score (2017 - 2018)', xlim=c(10, 36))
abline(v = mean(score), col = "red", lwd = 2)

score <- df.clean.act[df.clean.act$Year == '2018_19',]$ACT.Cumulative.Average
hist(score, col = 'magenta', xlab = paste('ACT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'ACT Score (2018 - 2019)', xlim=c(10, 36))
abline(v = mean(score), col = "red", lwd = 2)

score <- df.clean.act[df.clean.act$Year == '2019_20',]$ACT.Cumulative.Average
hist(score, col = 'gold', xlab = paste('ACT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'ACT Score (2019 - 2020)', xlim=c(10, 36))
abline(v = mean(score), col = "red", lwd = 2)
dev.copy(png, filename = 'visualizations/act_score_histogram.png', width = 1400, height = 865, res = 200)
dev.off()
```

Here the distribution of ACT scores over time seem to indicate the slight increase in ACT score average over time. Since the scale is much smaller, it is not entirely clear how much scores change.

```{r}
par(mfrow = c(2,3))
# Side by side distribution over time
boxplot(df.clean.act[df.clean.act$Year == '2014_15',]$ACT.Cumulative.Average, col = 'orange', 
        xlab = 'ACT Score', main = 'Average ACT (2014 - 2015)')
boxplot(df.clean.act[df.clean.act$Year == '2015_16',]$ACT.Cumulative.Average, col = 'red', 
        xlab = 'ACT Score', main = 'Average ACT (2015 - 2016)')
boxplot(df.clean.act[df.clean.act$Year == '2016_17',]$ACT.Cumulative.Average, col = 'green', 
        xlab = 'ACT Score', main = 'Average ACT (2016 - 2017)')
boxplot(df.clean.act[df.clean.act$Year == '2017_18',]$ACT.Cumulative.Average, col = 'blue', 
        xlab = 'ACT Score', main = 'Average ACT (2017 - 2018)')
boxplot(df.clean.act[df.clean.act$Year == '2018_19',]$ACT.Cumulative.Average, col = 'magenta', 
        xlab = 'ACT Score', main = 'Average ACT (2018 - 2019)')
boxplot(df.clean.act[df.clean.act$Year == '2019_20',]$ACT.Cumulative.Average, col = 'gold', 
        xlab = 'ACT Score', main = 'Average ACT (2019 - 2020)')
dev.copy(png, filename = 'visualizations/act_score_boxplot.png', width = 1400, height = 865, res = 200)
dev.off()
```

Here the distribution of ACT scores can more easily be visualized. It is more clear that scores in 2016 tended to be higher with a smaller quartile range, while scores in 2018 tended to be lower.

### Average Cost over time
```{r}
df.clean.cost <- df %>%
  drop_na(Average.Cost.per.Academic.Year)
write.csv(df.clean.cost, 'data/cleaned_cost.csv', row.names = FALSE)

par(mfrow = c(2,3))
# Side by side distribution over time
cost <- df.clean.cost[df.clean.cost$Year == '2014_15',]$Average.Cost.per.Academic.Year
hist(cost, col = 'orange', xlab = paste('Average Cost ($', round(mean(cost), 2), ')', sep = ''), 
     main = 'Average Cost (2014 - 2015)', xlim=c(5000, 80000))
abline(v = mean(cost), col = "red", lwd = 2)

cost <- df.clean.cost[df.clean.cost$Year == '2015_16',]$Average.Cost.per.Academic.Year
hist(cost, col = 'cyan', xlab = paste('Average Cost ($', round(mean(cost), 2), ')', sep = ''), 
     main = 'Average Cost (2015 - 2016)', xlim=c(5000, 80000))
abline(v = mean(cost), col = "red", lwd = 2)

cost <- df.clean.cost[df.clean.cost$Year == '2016_17',]$Average.Cost.per.Academic.Year
hist(cost, col = 'green', xlab = paste('Average Cost ($', round(mean(cost), 2), ')', sep = ''), 
     main = 'Average Cost (2016 - 2017)', xlim=c(5000, 80000))
abline(v = mean(cost), col = "red", lwd = 2)

cost <- df.clean.cost[df.clean.cost$Year == '2017_18',]$Average.Cost.per.Academic.Year
hist(cost, col = 'blue', xlab = paste('Average Cost ($', round(mean(cost), 2), ')', sep = ''), 
     main = 'Average Cost (2017 - 2018)', xlim=c(5000, 80000))
abline(v = mean(cost), col = "red", lwd = 2)

cost <- df.clean.cost[df.clean.cost$Year == '2018_19',]$Average.Cost.per.Academic.Year
hist(cost, col = 'magenta', xlab = paste('Average Cost ($', round(mean(cost), 2), ')', sep = ''), 
     main = 'Average Cost (2018 - 2019)', xlim=c(5000, 80000))
abline(v = mean(cost), col = "red", lwd = 2)

cost <- df.clean.cost[df.clean.cost$Year == '2019_20',]$Average.Cost.per.Academic.Year
hist(cost, col = 'gold', xlab = paste('Average Cost ($', round(mean(cost), 2), ')', sep = ''), 
     main = 'Average Cost (2019 - 2020)', xlim=c(5000, 80000))
abline(v = mean(cost), col = "red", lwd = 2)

dev.copy(png, filename = 'visualizations/average_cost_histogram.png', width = 1400, height = 865, res = 200)
dev.off()
```
Here the distribution of average cost over time is seen. From the visualizations plus the analysis of the averages, the cost of school has clearly risen on a consistent basis by around $1000 per year.
```{r}
par(mfrow = c(2,3))
# Side by side distribution over time
boxplot(df.clean.cost[df.clean.cost$Year == '2014_15',]$Average.Cost.per.Academic.Year, 
        col = 'orange', xlab = 'Average Cost', main = 'Average Cost (2014 - 2015)')
boxplot(df.clean.cost[df.clean.cost$Year == '2015_16',]$Average.Cost.per.Academic.Year, 
        col = 'red', xlab = 'Average Cost', main = 'Average Cost (2015 - 2016)')
boxplot(df.clean.cost[df.clean.cost$Year == '2016_17',]$Average.Cost.per.Academic.Year, 
        col = 'green', xlab = 'Average Cost', main = 'Average Cost (2016 - 2017)')
boxplot(df.clean.cost[df.clean.cost$Year == '2017_18',]$Average.Cost.per.Academic.Year, 
        col = 'blue', xlab = 'Average Cost', main = 'Average Cost (2017 - 2018)')
boxplot(df.clean.cost[df.clean.cost$Year == '2018_19',]$Average.Cost.per.Academic.Year, 
        col = 'magenta', xlab = 'Average Cost', main = 'Average Cost (2018 - 2019)')
boxplot(df.clean.cost[df.clean.cost$Year == '2019_20',]$Average.Cost.per.Academic.Year, 
        col = 'gold', xlab = 'Average Cost', main = 'Average Cost (2019 - 2020)')
dev.copy(png, filename = 'visualizations/average_cost_boxplot.png', width = 1400, height = 865, res = 200)
dev.off()
```

Here again, the distribution of average cost over time seems to point towards a consistent rising cost over the past five years.

### Admissions Rate over time
```{r}
df.clean.rate <- df %>%
  drop_na(Admission.Rate)
write.csv(df.clean.rate, 'data/cleaned_admissions_rates.csv', row.names = FALSE)

par(mfrow = c(2,3))
# Side by side distribution over time
rate <- df.clean.rate[df.clean.rate$Year == '2014_15',]$Admission.Rate
hist(rate, col = 'orange', 
     xlab = paste('Admission Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Admission Rate (2014 - 2015)')
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.rate[df.clean.rate$Year == '2015_16',]$Admission.Rate
hist(rate, col = 'cyan', 
     xlab = paste('Admission Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Admission Rate (2015 - 2016)')
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.rate[df.clean.rate$Year == '2016_17',]$Admission.Rate
hist(rate, col = 'green', 
     xlab = paste('Admission Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Admission Rate (2016 - 2017)')
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.rate[df.clean.rate$Year == '2017_18',]$Admission.Rate
hist(rate, col = 'blue', 
     xlab = paste('Admission Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Admission Rate (2017 - 2018)')
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.rate[df.clean.rate$Year == '2018_19',]$Admission.Rate
hist(rate, col = 'magenta', 
     xlab = paste('Admission Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Admission Rate (2018 - 2019)')
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.rate[df.clean.rate$Year == '2019_20',]$Admission.Rate
hist(rate, col = 'gold', 
     xlab = paste('Admission Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Admission Rate (2019 - 2020)')
abline(v = mean(rate), col = "red", lwd = 2)
dev.copy(png, filename = 'visualizations/admissions_rate_histogram.png', width = 1400, height = 865, res = 200)
dev.off()
```

Here the distribution of admissions rate is seen over a period of 6 years. From the visualizations and the calculated averages, it is clear that admissions rates has not changed much over the period of observations.

```{r}
par(mfrow = c(2,3))
# Side by side distribution over time
boxplot(df.clean.rate[df.clean.rate$Year == '2014_15',]$Admission.Rate, col = 'orange', 
        xlab = 'Admission Rate', main = 'Admission Rate (2014 - 2015)')
boxplot(df.clean.rate[df.clean.rate$Year == '2015_16',]$Admission.Rate, col = 'red', 
        xlab = 'Admission Rate', main = 'Admission Rate (2015 - 2016)')
boxplot(df.clean.rate[df.clean.rate$Year == '2016_17',]$Admission.Rate, col = 'green', 
        xlab = 'Admission Rate', main = 'Admission Rate (2016 - 2017)')
boxplot(df.clean.rate[df.clean.rate$Year == '2017_18',]$Admission.Rate, col = 'blue', 
        xlab = 'Admission Rate', main = 'Admission Rate (2017 - 2018)')
boxplot(df.clean.rate[df.clean.rate$Year == '2018_19',]$Admission.Rate, col = 'magenta', 
        xlab = 'Admission Rate', main = 'Admission Rate (2018 - 2019)')
boxplot(df.clean.rate[df.clean.rate$Year == '2019_20',]$Admission.Rate, col = 'gold', 
        xlab = 'Admission Rate', main = 'Admission Rate (2019 - 2020)')
dev.copy(png, filename = 'visualizations/admissions_rate_boxplot.png', width = 1400, height = 865, res = 200)
dev.off()
```


### Completion Rate over time
```{r}
df.clean.rate <- df %>%
  drop_na(Completion.Rate..4.year.institutions) %>%
  transform(Completion.Rate..4.year.institutions = Completion.Rate..4.year.institutions * 100)
write.csv(df.clean.rate, 'data/cleaned_completion_rates.csv', row.names = FALSE)

par(mfrow = c(2,3))
# Side by side distribution over time
rate <- df.clean.rate[df.clean.rate$Year == '2014_15',]$Completion.Rate..4.year.institutions
hist(rate, col = 'orange', 
     xlab = paste('Completion Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Completion Rate (2014 - 2015)')
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.rate[df.clean.rate$Year == '2015_16',]$Completion.Rate..4.year.institutions
hist(rate, col = 'cyan', 
     xlab = paste('Completion Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Completion Rate (2015 - 2016)')
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.rate[df.clean.rate$Year == '2016_17',]$Completion.Rate..4.year.institutions
hist(rate, col = 'green', 
     xlab = paste('Completion Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Completion Rate (2016 - 2017)')
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.rate[df.clean.rate$Year == '2017_18',]$Completion.Rate..4.year.institutions
hist(rate, col = 'blue', 
     xlab = paste('Completion Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Completion Rate (2017 - 2018)')
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.rate[df.clean.rate$Year == '2018_19',]$Completion.Rate..4.year.institutions
hist(rate, col = 'magenta', 
     xlab = paste('Completion Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Completion Rate (2018 - 2019)')
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.rate[df.clean.rate$Year == '2019_20',]$Completion.Rate..4.year.institutions
hist(rate, col = 'gold', 
     xlab = paste('Completion Rate (', round(mean(rate), 2), '%)', sep = ''), 
     main = 'Completion Rate (2019 - 2020)')
abline(v = mean(rate), col = "red", lwd = 2)
dev.copy(png, filename = 'visualizations/completion_rate_histogram.png', width = 1400, height = 865, res = 200)
dev.off()
```

```{r}
par(mfrow = c(2,3))
# Side by side distribution over time
boxplot(df.clean.rate[df.clean.rate$Year == '2014_15',]$Completion.Rate..4.year.institutions, 
        col = 'orange', xlab = 'Completion Rate', main = 'Completion Rate (2014 - 2015)')
boxplot(df.clean.rate[df.clean.rate$Year == '2015_16',]$Completion.Rate..4.year.institutions, 
        col = 'red', xlab = 'Completion Rate', main = 'Completion Rate (2015 - 2016)')
boxplot(df.clean.rate[df.clean.rate$Year == '2016_17',]$Completion.Rate..4.year.institutions, 
        col = 'green', xlab = 'Completion Rate', main = 'Completion Rate (2016 - 2017)')
boxplot(df.clean.rate[df.clean.rate$Year == '2017_18',]$Completion.Rate..4.year.institutions, 
        col = 'blue', xlab = 'Completion Rate', main = 'Completion Rate (2017 - 2018)')
boxplot(df.clean.rate[df.clean.rate$Year == '2018_19',]$Completion.Rate..4.year.institutions, 
        col = 'magenta', xlab = 'Completion Rate', main = 'Completion Rate (2018 - 2019)')
boxplot(df.clean.rate[df.clean.rate$Year == '2019_20',]$Completion.Rate..4.year.institutions, 
        col = 'gold', xlab = 'Completion Rate', main = 'Completion Rate (2019 - 2020)')
dev.copy(png, filename = 'visualizations/completion_rate_boxplot.png', width = 1400, height = 865, res = 200)
dev.off()
```


### Student Population over time
```{r}
df.clean.pop <- df %>%
  drop_na(Undergraduate.Enrollment)
write.csv(df.clean.pop, 'data/cleaned_enrollment.csv', row.names = FALSE)

par(mfrow = c(2,3))
# Side by side distribution over time
pop <- df.clean.pop[df.clean.pop$Year == '2014_15',]$Undergraduate.Enrollment
hist(pop, col = 'orange', 
     xlab = paste('Undergrad Enrollment (', round(mean(pop)), ')', sep = ''), 
     main = 'Enrollment (2014 - 2015)', xlim=c(0, 60000), breaks = 30)
abline(v = mean(pop), col = "red", lwd = 2)

pop <- df.clean.pop[df.clean.pop$Year == '2015_16',]$Undergraduate.Enrollment
hist(pop, col = 'cyan', 
     xlab = paste('Undergrad Enrollment (', round(mean(rate)), ')', sep = ''), 
     main = 'Enrollment (2015 - 2016)', xlim=c(0, 60000), breaks = 30)
abline(v = mean(pop), col = "red", lwd = 2)

pop <- df.clean.pop[df.clean.pop$Year == '2016_17',]$Undergraduate.Enrollment
hist(pop, col = 'green', 
     xlab = paste('Undergrad Enrollment (', round(mean(pop)), ')', sep = ''), 
     main = 'Enrollment (2016 - 2017)', xlim=c(0, 60000), breaks = 30)
abline(v = mean(pop), col = "red", lwd = 2)

rate <- df.clean.pop[df.clean.pop$Year == '2017_18',]$Undergraduate.Enrollment
hist(rate, col = 'blue', 
     xlab = paste('Undergrad Enrollment (', round(mean(pop)), ')', sep = ''), 
     main = 'Enrollment (2017 - 2018)', xlim=c(0, 60000), breaks = 30)
abline(v = mean(rate), col = "red", lwd = 2)

rate <- df.clean.pop[df.clean.pop$Year == '2018_19',]$Undergraduate.Enrollment
hist(rate, col = 'magenta', 
     xlab = paste('Undergrad Enrollment (', round(mean(pop)), ')', sep = ''), 
     main = 'Enrollment (2018 - 2019)', xlim=c(0, 60000), breaks = 30)
abline(v = mean(rate), col = "red", lwd = 2)

pop <- df.clean.pop[df.clean.pop$Year == '2019_20',]$Undergraduate.Enrollment
hist(pop, col = 'gold', 
     xlab = paste('Undergrad Enrollment (', round(mean(pop)), ')', sep = ''), 
     main = 'Enrollment (2019 - 2020)', xlim=c(0, 60000), breaks = 30)
abline(v = mean(pop), col = "red", lwd = 2)
dev.copy(png, filename = 'visualizations/student_population_histogram.png', width = 1400, height = 865, res = 200)
dev.off()
```
Here the distribution of enrollment seems to indicate an exponential distribution, but the overall average enrollment does not change over time.

```{r}
par(mfrow = c(2,3))
# Side by side distribution over time
boxplot(df.clean.pop[df.clean.pop$Year == '2014_15',]$Undergraduate.Enrollment, 
        col = 'orange', xlab = 'Enrollment', main = 'Enrollment (2014 - 2015)')
boxplot(df.clean.pop[df.clean.pop$Year == '2015_16',]$Undergraduate.Enrollment, 
        col = 'red', xlab = 'Enrollment', main = 'Enrollment (2015 - 2016)')
boxplot(df.clean.pop[df.clean.pop$Year == '2016_17',]$Undergraduate.Enrollment, 
        col = 'green', xlab = 'Enrollment', main = 'Enrollment (2016 - 2017)')
boxplot(df.clean.pop[df.clean.pop$Year == '2017_18',]$Undergraduate.Enrollment, 
        col = 'blue', xlab = 'Enrollment', main = 'Enrollment (2017 - 2018)')
boxplot(df.clean.pop[df.clean.pop$Year == '2018_19',]$Undergraduate.Enrollment, 
        col = 'magenta', xlab = 'Enrollment', main = 'Enrollment (2018 - 2019)')
boxplot(df.clean.pop[df.clean.pop$Year == '2019_20',]$Undergraduate.Enrollment, 
        col = 'gold', xlab = 'Enrollment', main = 'Enrollment (2019 - 2020)')
dev.copy(png, filename = 'visualizations/student_population_boxplot.png', width = 1400, height = 865, res = 200)
dev.off()
```
By using a set of boxplots, a couple of outliers are seen and require further investigation. Specifically, from 2014-2016, there is a school with more than 130,000 students.

```{r}
df.clean.pop$Size = cut(df.clean.pop$Undergraduate.Enrollment, 
                                       c(0,1000,1800,3000,9000,Inf),
                                       labels=c('Very Small','Small','Medium',
                                                'Large','Very Large'))
df.clean.pop <- df.clean.pop %>% drop_na(Size)
level_size <- factor(df.clean.pop$Size, levels = c('Very Small', 'Small', 'Medium', 
                                                   'Large', 'Very Large'))
write.csv(df.clean.pop, 'data/cleaned_binned_enrollment.csv', row.names = FALSE)

table(df.clean.pop[df.clean.pop$Year == '2014_15',]$Size)
table(df.clean.pop[df.clean.pop$Year == '2015_16',]$Size)
table(df.clean.pop[df.clean.pop$Year == '2016_17',]$Size)

# Side by side distribution over time
p1 <- ggplot(df.clean.pop[df.clean.pop$Year == '2014_15',], aes(x = Size, fill = Size)) + 
  geom_bar(stat = 'count') + 
  ggtitle("Enrollment (2014-2015)") + 
  ylab('Frequency') + 
  guides(fill = "none")
p1
dev.copy(png, filename = 'visualizations/enrollment_over_time_2014_bar_graph.png', width = 1400, height = 865, res = 200)
dev.off()
p2 <- ggplot(df.clean.pop[df.clean.pop$Year == '2015_16',], aes(x = Size, fill = Size)) + 
  geom_bar(stat = 'count') + 
  ggtitle("Enrollment (2015-2016)") + 
  ylab('Frequency') + guides(fill = "none")
p3 <- ggplot(df.clean.pop[df.clean.pop$Year == '2016_17',], aes(x = Size, fill = Size)) + 
  geom_bar(stat = 'count') + 
  ggtitle("Enrollment (2016-2017)") + 
  ylab('Frequency') + 
  guides(fill = "none")
p4 <- ggplot(df.clean.pop[df.clean.pop$Year == '2017_18',], aes(x = Size, fill = Size)) + 
  geom_bar(stat = 'count') + 
  ggtitle("Enrollment (2017-2018)") + 
  ylab('Frequency') + 
  guides(fill = "none")
p5 <- ggplot(df.clean.pop[df.clean.pop$Year == '2018_19',], aes(x = Size, fill = Size)) + 
  geom_bar(stat = 'count') + 
  ggtitle("Enrollment (2018-2019)") + 
  ylab('Frequency') + 
  guides(fill = "none")
p6 <- ggplot(df.clean.pop[df.clean.pop$Year == '2019_20',], aes(x = Size, fill = Size)) + 
  geom_bar(stat = 'count') + 
  ggtitle("Enrollment (2019-2020)") + 
  ylab('Frequency') + 
  guides(fill = "none")
grid.arrange(p1, p2, p3, p4, p5, p6, ncol = 2)
dev.copy(png, filename = 'visualizations/enrollment_over_time_bar_graph.png', width = 1400, height = 865, res = 200)
dev.off()
```

Here size is broken down and discretized into five separate bins. We can see the relatively even distribution of universities across those bins.

### Region Discretization
```{r}
stateAbbrPlusDC <- c(state.abb, 'DC')
stateRegionPlusDC <- as.factor(c(as.character(state.region), 'South'))
# Create new column for region
df.clean.region = df
df.clean.region$Region <- stateRegionPlusDC[match(df.clean.region$University.State, stateAbbrPlusDC)]

df.clean.region <- df.clean.region %>% drop_na(Region)
write.csv(df.clean.pop, 'data/cleaned_binned_region.csv', row.names = FALSE)

# Side by side distribution over time
p1 <- ggplot(df.clean.region[df.clean.region$Year == '2014_15',], aes(x = Region, fill = Region)) + 
  geom_bar(stat = 'count') + 
  ggtitle("Number of colleges per region (2014-2015)") + 
  ylab('Frequency') + 
  guides(fill = "none")
p1
dev.copy(png, filename = 'visualizations/region_over_time_2014_bar_graph.png', width = 1400, height = 865, res = 200)
dev.off()
```

Here the number of colleges per region is seen using a simple bar chart. 

## Distributions
### SAT Scores
```{r}
df.clean.sat <- df %>%
  drop_na(SAT.Average) %>%
  filter(Year == '2014_15')
write.csv(df.clean.sat, 'data/sat_score_distribution.csv', row.names = FALSE)

# Create histogram of Average SAT Scores across all colleges
score <- df.clean.sat$SAT.Average
hist(score, col = 'orange', 
     xlab = paste('SAT Score (', round(mean(score), 0), ')', sep = ''), 
     main = 'SAT Score (2014 - 2015)')
abline(v = mean(score), col = "red", lwd = 2)

# Create QQNorm plot of SAT scores
qqnorm(score, col = 'orange', main = 'QQ Norm plot of SAT Scores')
qqline(score, col = 'black')

# Plot the ECDF
plot.ecdf(score, col = 'darkgreen', main = 'ECDF of SAT Scores')
```

Using a variety of techniques, we can show the SAT scores are normally distributed, which is generally useful when it comes to making assumptions and analyzing the data. Shown above are a histogram of the scores, a qqnorm plot, the results of a shapiro wilk test, and an ECDF of the data. We can see the data is slightly skewed towards lower scores which makes perfect sense. using the qqnorm plot, we can again see these results. Finally, using an ECDF, we can see the data looks normal as well. 

### Undergrad Enrollment Sizes
```{r}
df.clean.size <- df %>%
  drop_na(Undergraduate.Enrollment) %>%
  filter(Year == '2014_15') %>%
  filter(Undergraduate.Enrollment < 100000)
write.csv(df.clean.size, 'data/enrollment_distribution.csv', row.names = FALSE)

# Create histogram of Undergraduate Enrollment across all colleges
size <- df.clean.size$Undergraduate.Enrollment
hist(size, col = 'orange', 
     xlab = paste('Undergraduate Enrollment (', round(mean(size), 0), ')', sep = ''), 
     main = 'Undergraduate Enrollment (2014 - 2015)')
abline(v = mean(size), col = "red", lwd = 2)

# Plot the ECDF
plot.ecdf(size, col = 'darkgreen', main = 'ECDF of SAT Scores')

# MLE of Exponential Distribution
unbiased.estimator.lambda <- ((length(size) - 2) / (length(size) - 1)) * (1 / mean(size))
size.sim <- rexp(10000, rate = unbiased.estimator.lambda)
hist(size.sim, col = 'lightblue', 
     xlab = paste('Simulated Undergraduate Enrollment (', round(mean(size), 0), ')', sep = ''), 
     main = 'Simulated Undergraduate Enrollment (2014 - 2015)')
abline(v = mean(size.sim), col = "red", lwd = 2)
```

Using a variety of techniques, we can show the undergraduate enrollment sizes are exponential distributed, which can be useful when doing further analysis of the data. Shown above is the histogram of the set of the data, an ECDF of the data, both of which indicate the presence of an exponential distribution. Following that train of thought, we used a MLE estimator to gauge the value of lambda (the rate), and from there, we plotted a simulated version of the data to check to see whether the data looked similar. Using that MLE estimator, we can visually see the data looks close in distribution.


### Distribution of Cost
```{r}
df.clean.cost <- df %>%
  drop_na(Average.Cost.per.Academic.Year) %>%
  filter(Year == '2014_15')
write.csv(df.clean.cost, 'data/cost_distribution.csv', row.names = FALSE)

# Create histogram of Average Cost across all colleges
cost <- df.clean.cost$Average.Cost.per.Academic.Year
hist(cost, col = 'orange', 
     xlab = paste('Average Cost (', round(mean(cost), 0), ')', sep = ''), 
     main = 'Average Cost (2014 - 2015)')
abline(v = mean(cost), col = "red", lwd = 2)

# Plot the ECDF
plot.ecdf(cost, col = 'darkgreen', main = 'ECDF of Average Cost')
```
From the ecdf and histograms of cost, it is less clear how cost is distributed. Perhaps a skewed normal distribution or something log normal like.

## Conditional Statistics
```{r}
# Calculate some basic conditional probabilities
df.clean <- read.csv('data/school_statistics.csv') %>% 
  transform(Size = as.factor(Size),
            Region = as.factor(Region),
            Comp.Rate.17_18.BIN = as.factor(Comp.Rate.17_18.BIN))
# Total number of schools
nrow(df.clean)
print('Statistics on graduation rate')
# Number of schools with low graduation rate
(grad.total <- nrow(df.clean[(df.clean$Comp.Rate.17_18.BIN == 'Low'),]))
# Number of schools with high graduation rate
(grad.total <- nrow(df.clean[(df.clean$Comp.Rate.17_18.BIN == 'High'),]))

print('Statistics on location')
# Number of schools in northeast
(location.total <- nrow(df.clean[(df.clean$Region == 'Northeast'),]))
# Number of schools in south
(location.total <- nrow(df.clean[(df.clean$Region == 'South'),]))
# Number of schools in north central
(location.total <- nrow(df.clean[(df.clean$Region == 'North Central'),]))
# Number of schools in west
(location.total <- nrow(df.clean[(df.clean$Region == 'West'),]))

df.probs <- data.frame(matrix(0, nrow = 4,  ncol = 2))
colnames(df.probs) <- c('Low', 'High')
rownames(df.probs) <- as.character(levels(state.region))

for (r in rownames(df.probs)) {
  region <- nrow(df.clean[(df.clean$Region == r),])
  for (c in colnames(df.probs)) {
    prob <- round(nrow(df.clean[
      (df.clean$Region == r) & (df.clean$Comp.Rate.17_18.BIN == c)
      ,]) / region, 3)
    df.probs[r, c] <- prob
  }
}
write.csv(df.probs, 'data/location_completion_rate.csv', row.names = TRUE)

print('Statistics on size')
# Number of very small schools
(size.total <- nrow(df.clean[(df.clean$Size == 'Very Small'),]))
# Number of small schools
(size.total <- nrow(df.clean[(df.clean$Size == 'Small'),]))
# Number of medium schools
(size.total <- nrow(df.clean[(df.clean$Size == 'Medium'),]))
# Number of large schools
(size.total <- nrow(df.clean[(df.clean$Size == 'Large'),]))
# Number of very large schools
(size.total <- nrow(df.clean[(df.clean$Size == 'Very Large'),]))

df.probs.2 <- data.frame(matrix(0, nrow = 5,  ncol = 2))
colnames(df.probs.2) <- c('Low', 'High')
rownames(df.probs.2) <- c('Very Small', 'Small', 'Medium', 'Large', 'Very Large')

# Investigate Size vs Completion Rate
for (r in rownames(df.probs.2)) {
  size <- nrow(df.clean[(df.clean$Size == r),])
  for (c in colnames(df.probs.2)) {
    prob <- round(nrow(df.clean[
      (df.clean$Size == r) & (df.clean$Comp.Rate.17_18.BIN == c),
      ]) / size, 3)
    df.probs.2[r, c] <- prob
  }
}
write.csv(df.probs.2, 'data/size_completion_rate.csv', row.names = TRUE)

# Investigate Size and Region vs Completion Rate
regions <- c('Northeast', 'South', 'North Central', 'West')
for (region in regions) {
  df.probs.region <- data.frame(matrix(0, nrow = 5,  ncol = 2))
  rownames(df.probs.region) <- c('Very Small', 'Small', 'Medium', 'Large', 'Very Large')
  colnames(df.probs.region) <- c('Low', 'High')
  for (r in rownames(df.probs.region)) {
    size.and.region <- nrow(df.clean[(df.clean$Size == r) & (df.clean$Region == region),])
    for (c in colnames(df.probs.region)) {
      prob <- round(nrow(df.clean[
        (df.clean$Size == r) & (df.clean$Region == region) & (df.clean$Comp.Rate.17_18.BIN == c),
        ]) / size.and.region, 3)
      df.probs.region[r, c] <- prob
    }
  }
  print(df.probs.region)
  write.csv(df.probs.region, paste('data/', gsub(" ", "", tolower(region), fixed = TRUE), '_size_completion_rate.csv', sep = ''))
}

```

 This is a set of conditional probability tables built to better understand the effect of region and size on graduation rates.

# Interactive
### SAT Score vs Admissions Rate

```{r}
# Plot relationship between admissions rate and average SAT score for 2014-2015
df.clean <- df %>% 
  select(Color, University.Name, Admission.Rate, SAT.Average, Year) %>%
  filter(Year == admission.year) %>%
  drop_na(SAT.Average, Admission.Rate)
write.csv(df.clean, 'data/sat_score_vs_admission_rate.csv', row.names = FALSE)

df.clean %>%
  plotly::plot_ly(x = ~SAT.Average, 
                  y = ~Admission.Rate, 
                  text = ~University.Name,
                  hoverinfo = 'text',
                  marker = list(color = factor(df.clean$Color, labels = c('black', 'red'))),
                  type = 'scatter', 
                  mode = 'markers') %>%
     plotly::layout(title = 'SAT Average vs Admissions rate (2014-2015)', 
                    xaxis = list(title = 'Average SAT Score'), 
                    yaxis = list(title = 'Admissions Rate'))
```

Here we have a simple plot of SAT Score vs Admissions Rate. Even though this is not going to be used further down the road, it is important to see that the higher the SAT score, the lower the admissions rate, and that makes intuitive sense.

### SAT Score vs Completion Rate
``` {r}
# Plot SAT average versus completion
df.2014.admissions <- df %>%
  select(Year, SAT.Average, University.Name, Color) %>%
  filter(Year == admission.year)

df.2018.grads <- df %>%
  select(Year, Completion.Rate..4.year.institutions, University.Name) %>%
  filter(Year == graduation.year)

merged.df <- merge(df.2014.admissions, df.2018.grads, by = 'University.Name') %>%
  rename(Year.Admit = Year.x,
         Year.Graduate = Year.y) %>%
  drop_na(SAT.Average, Completion.Rate..4.year.institutions) %>%
  transform(Completion.Rate..4.year.institutions = Completion.Rate..4.year.institutions * 100)

write.csv(merged.df, 'data/sat_score_vs_completion_rate.csv', row.names = FALSE)

line.fit.b = list(dash="solid", width = 3, color='blue')
line.fit.r = list(dash="solid", width = 3, color='red')
line.fit.g = list(dash="solid", width = 3, color='chartreuse')
linear = lm(Completion.Rate..4.year.institutions~SAT.Average, data = merged.df)
quadratic = lm(Completion.Rate..4.year.institutions~SAT.Average + I(SAT.Average ^ 2), data = merged.df)
cubic = lm(Completion.Rate..4.year.institutions~SAT.Average + 
             I(SAT.Average ^ 2) + 
             I(SAT.Average ^ 3), data = merged.df)

(p <- merged.df %>%
  plotly::plot_ly(x = ~SAT.Average) %>%
  plotly::add_markers(y = ~Completion.Rate..4.year.institutions, 
                  marker = list(color = factor(merged.df$Color, labels = c('black', 'red'))),
                  hoverinfo = 'text',
                  hovertemplate = paste('<b>Name</b>: %{text}',
                                        '<br><b>SAT Score</b>: %{x}',
                                        '<br><b>Completion Rate</b>: %{y}%'),
                  text = ~University.Name) %>%
  plotly::layout(title = 'SAT Average vs Completion Rate', 
                    xaxis = list(title = 'SAT Average'), 
                    yaxis = list(title = 'Completion Rate')) %>%
  plotly::add_lines(x = ~SAT.Average, y = predict(linear), 
                    line = line.fit.b, name = 'Linear', mode = 'lines') %>%
  plotly::add_lines(x = ~SAT.Average, y = predict(quadratic), 
                    line = line.fit.r, name = 'Quadratic', mode = 'lines') %>%
  plotly::add_lines(x = ~SAT.Average, y = predict(cubic), 
                    line = line.fit.g, name = 'Cubic', mode = 'lines'))

saveWidget(p, "visualizations/sat_score_vs_completion.html", selfcontained = F, libdir = "lib")
orca(p, file = "visualizations/sat_score_vs_completion.png")
```

Here we have a visual of Average SAT scores vs Completion Rate. We can see the positive trend, indicating our hypothesis should be that higher SAT scores should give higher completion rates in schools. That also means that colleges that admit students with lower SAT scores might be completely unable to help those students complete college, which is a discouraging sign.

### ACT Score vs Completion
``` {r}
# Plot ACT average versus completion
df.2014.admissions <- df %>%
  select(Year, ACT.Cumulative.Average, University.Name, Color) %>%
  filter(Year == admission.year)

df.2018.grads <- df %>%
  select(Year, Completion.Rate..4.year.institutions, University.Name) %>%
  filter(Year == graduation.year)

merged.df <- merge(df.2014.admissions, df.2018.grads, by = 'University.Name') %>%
  rename(Year.Admit = Year.x,
         Year.Graduate = Year.y) %>%
  drop_na(ACT.Cumulative.Average, Completion.Rate..4.year.institutions) %>%
  transform(Completion.Rate..4.year.institutions = Completion.Rate..4.year.institutions * 100)

write.csv(merged.df, 'data/act_score_vs_completion_rate.csv', row.names = FALSE)

head(merged.df)

line.fit.b = list(dash="solid", width = 3, color='blue')
line.fit.r = list(dash="solid", width = 3, color='red')
line.fit.g = list(dash="solid", width = 3, color='chartreuse')
linear = lm(Completion.Rate..4.year.institutions~ACT.Cumulative.Average, data = merged.df)
quadratic = lm(Completion.Rate..4.year.institutions~ACT.Cumulative.Average + I(ACT.Cumulative.Average ^ 2), data = merged.df)
cubic = lm(Completion.Rate..4.year.institutions~ACT.Cumulative.Average + 
             I(ACT.Cumulative.Average ^ 2) + 
             I(ACT.Cumulative.Average ^ 3), data = merged.df)

(p <- merged.df %>% 
  plotly::plot_ly(x = ~ACT.Cumulative.Average) %>%
  plotly::add_markers(y = ~Completion.Rate..4.year.institutions, 
                  marker = list(color = factor(merged.df$Color, labels = c('black', 'red'))),
                  hoverinfo = 'text',
                  hovertemplate = paste('<b>Name</b>: %{text}',
                                        '<br><b>ACT Score</b>: %{x}',
                                        '<br><b>Completion Rate</b>: %{y}%'),
                  text = ~University.Name) %>%
  plotly::layout(title = 'ACT Score vs Completion Rate', 
                    xaxis = list(title = 'ACT Score'), 
                    yaxis = list(title = 'Completion Rate')) %>%
  plotly::add_lines(x = ~ACT.Cumulative.Average, y = predict(linear), 
                    line = line.fit.b, name = 'Linear', mode = 'lines') %>%
  plotly::add_lines(x = ~ACT.Cumulative.Average, y = predict(quadratic), 
                    line = line.fit.r, name = 'Quadratic', mode = 'lines') %>%
  plotly::add_lines(x = ~ACT.Cumulative.Average, y = predict(cubic), 
                    line = line.fit.g, name = 'Cubic', mode = 'lines'))
saveWidget(p, "visualizations/act_score_vs_completion.html", selfcontained = F, libdir = "lib")
orca(p, file = "visualizations/act_score_vs_completion.png")
```

Here we have ACT Scores vs Completion Rate. Here we can see that compared to SAT scores, this doesn't really give us as much insight as a visual, so we might hypothesize that SAT scores would give us more insight when it comes to hypothesis testing.

### Average Cost vs Completion
``` {r}
# Plot average cost versus completion
df.clean <- df %>% 
  select(Color, University.Name, Completion.Rate..4.year.institutions, Average.Cost.per.Academic.Year, Year) %>%
  filter(Year == admission.year) %>%
  drop_na(Completion.Rate..4.year.institutions, Average.Cost.per.Academic.Year) %>%
  transform(Completion.Rate..4.year.institutions = Completion.Rate..4.year.institutions * 100)

write.csv(df.clean, 'data/cost_vs_completion_rate.csv', row.names = FALSE)

line.fit.b = list(dash="solid", width = 3, color='blue')
line.fit.r = list(dash="solid", width = 3, color='red')
line.fit.g = list(dash="solid", width = 3, color='chartreuse')
linear = lm(Completion.Rate..4.year.institutions~Average.Cost.per.Academic.Year, data = df.clean)
quadratic = lm(Completion.Rate..4.year.institutions~Average.Cost.per.Academic.Year + I(Average.Cost.per.Academic.Year ^ 2), data = df.clean)
cubic = lm(Completion.Rate..4.year.institutions~Average.Cost.per.Academic.Year + 
             I(Average.Cost.per.Academic.Year ^ 2) + 
             I(Average.Cost.per.Academic.Year ^ 3), data = df.clean)

(p <- df.clean %>%
  plotly::plot_ly(x = ~Average.Cost.per.Academic.Year) %>%
  plotly::add_markers(y = ~Completion.Rate..4.year.institutions, 
                  marker = list(color = factor(df.clean$Color, labels = c('black', 'red'))),
                  hoverinfo = 'text',
                  hovertemplate = paste('<b>Name</b>: %{text}',
                                        '<br><b>Cost</b>: $%{x}',
                                        '<br><b>Completion Rate</b>: %{y}%'),
                  text = ~University.Name) %>%
  plotly::layout(title = 'Average Cost vs Completion Rate', 
                    xaxis = list(title = 'Average Cost'), 
                    yaxis = list(title = 'Completion Rate')) %>%
  plotly::add_lines(x = ~Average.Cost.per.Academic.Year, y = predict(linear), 
                    line = line.fit.b, name = 'Linear', mode = 'lines') %>%
  plotly::add_lines(x = ~Average.Cost.per.Academic.Year, y = predict(quadratic), 
                    line = line.fit.r, name = 'Quadratic', mode = 'lines') %>%
  plotly::add_lines(x = ~Average.Cost.per.Academic.Year, y = predict(cubic), 
                    line = line.fit.g, name = 'Cubic', mode = 'lines'))

saveWidget(p, "visualizations/cost_vs_completion.html", selfcontained = F, libdir = "lib")
orca(p, file = "visualizations/cost_vs_completion.png")
```

Here we can see a visual of Average Cost vs Completion Rate, which is one of the questions we want to answer (Does cost impact completion rate). We also fitted a couple of linear regression lines to see which fit the best. Any of the three types could be argued as the best, so the simpliest (linear) is the one to use.

### Undergraduate Enrollment vs Completion
``` {r}
# Plot enrollment versus completion
df.clean <- df %>% 
  select(Color, University.Name, Completion.Rate..4.year.institutions, Undergraduate.Enrollment, Year) %>%
  filter(Year == admission.year) %>%
  drop_na(Completion.Rate..4.year.institutions, Undergraduate.Enrollment) %>%
  transform(Completion.Rate..4.year.institutions = Completion.Rate..4.year.institutions * 100) %>%
  filter(Undergraduate.Enrollment < 100000)

write.csv(df.clean, 'data/enrollment_vs_completion_rate.csv', row.names = FALSE)

line.fit.b = list(dash="solid", width = 3, color='blue')
line.fit.r = list(dash="solid", width = 3, color='red')
line.fit.g = list(dash="solid", width = 3, color='chartreuse')
linear = lm(Completion.Rate..4.year.institutions~Undergraduate.Enrollment, data = df.clean)
quadratic = lm(Completion.Rate..4.year.institutions~Undergraduate.Enrollment + I(Undergraduate.Enrollment ^ 2), data = df.clean)
cubic = lm(Completion.Rate..4.year.institutions~Undergraduate.Enrollment + 
             I(Undergraduate.Enrollment ^ 2) + 
             I(Undergraduate.Enrollment ^ 3), data = df.clean)

(p <- df.clean %>%
  plotly::plot_ly(x = ~Undergraduate.Enrollment) %>%
  plotly::add_markers(y = ~Completion.Rate..4.year.institutions, 
                  marker = list(color = factor(df.clean$Color, labels = c('black', 'red'))),
                  hoverinfo = 'text',
                  hovertemplate = paste('<b>Name</b>: %{text}',
                                        '<br><b>Enrollment</b>: %{x}',
                                        '<br><b>Completion Rate</b>: %{y}%'),
                  text = ~University.Name) %>%
  plotly::layout(title = 'Enrollment vs Completion Rate', 
                    xaxis = list(title = 'Enrollment'), 
                    yaxis = list(title = 'Completion Rate')) %>%
  plotly::add_lines(x = ~Undergraduate.Enrollment, y = predict(linear), 
                    line = line.fit.b, name = 'Linear', mode = 'lines') %>%
  plotly::add_lines(x = ~Undergraduate.Enrollment, y = predict(quadratic), 
                    line = line.fit.r, name = 'Quadratic', mode = 'lines') %>%
  plotly::add_lines(x = ~Undergraduate.Enrollment, y = predict(cubic), 
                    line = line.fit.g, name = 'Cubic', mode = 'lines'))

saveWidget(p, "visualizations/enrollment_vs_completion.html", selfcontained = F, libdir = "lib")
orca(p, file = "visualizations/enrollment_vs_completion.png")
```

Here we can see a visual of enrollment vs completion rate. Importantly, we can visually inspect the points on the graph to get a better sense of the data and see if there are any trends (especially if we want to fit regression lines). However, when graphing this data, it is clear there is an outlier. The University of Phoenix-Arizona has over 150,000 students! We should probably remove this datapoint before continuing our analysis.

### Average Cost/Enrollment vs Completion
``` {r}
# Plot average cost/enrollment versus completion
df.clean <- df %>% 
  select(Color, University.Name, Completion.Rate..4.year.institutions, Undergraduate.Enrollment, Average.Cost.per.Academic.Year, Year) %>%
  filter(Year == '2019_20') %>%
  drop_na(Completion.Rate..4.year.institutions, Undergraduate.Enrollment, Average.Cost.per.Academic.Year) %>%
  transform(Completion.Rate..4.year.institutions = Completion.Rate..4.year.institutions * 100)

write.csv(df.clean, 'data/cost_and_enrollment_vs_completion_rate.csv', row.names = FALSE)

(p <- df.clean %>%
  plotly::plot_ly(x = ~Undergraduate.Enrollment) %>%
  plotly::add_markers(y = ~Completion.Rate..4.year.institutions, 
                  marker = list(color = ~Average.Cost.per.Academic.Year, 
                                colorscale = 'Rainbow', 
                                showscale = TRUE),
                  hoverinfo = 'text',
                  hovertemplate = paste('<b>Name</b>: %{text}',
                                        '<br><b>Cost</b>: $%{marker.color}',
                                        '<br><b>Completion Rate</b>: %{y}%',
                                        '<br><b>Enrollment</b>: %{x}'),
                  text = ~University.Name) %>%
  plotly::layout(title = 'Enrollment vs Completion Rate (including Cost)', 
                    xaxis = list(title = 'Enrollment'), 
                    yaxis = list(title = 'Completion Rate')))
saveWidget(p, "visualizations/enrollment_cost_vs_completion.html", selfcontained = F, libdir = "lib")
orca(p, file = "visualizations/enrollment_cost_vs_completion.png")
```

Here by plotting enrollment vs completion rate with a color scale associated with cost, some interesting results are seen. First, as completion rate increases, cost also tends to increase. However, by zooming into the highest graduation rate schools, some of the highest graduation rate schools actually do not cost much all things considered. Also, by viewing the graph as a whole, most schools with a high graduation rate tend to be less than 10,000 students.

``` {r}
# Plot average cost/enrollment versus completion
df.clean <- df %>% 
  select(Color, University.Name, Completion.Rate..4.year.institutions, 
         Undergraduate.Enrollment, Average.Cost.per.Academic.Year, Year) %>%
  filter(Year == '2019_20') %>%
  drop_na(Completion.Rate..4.year.institutions, Undergraduate.Enrollment, Average.Cost.per.Academic.Year) %>%
  transform(Completion.Rate..4.year.institutions = Completion.Rate..4.year.institutions * 100)

write.csv(df.clean, 'data/enrollment_and_cost_vs_completion_rate.csv', row.names = FALSE)

(p <- df.clean %>%
  plotly::plot_ly(x = ~Average.Cost.per.Academic.Year) %>%
  plotly::add_markers(y = ~Completion.Rate..4.year.institutions, 
                  marker = list(color = ~Undergraduate.Enrollment, colorscale = 'Rainbow', showscale = TRUE),
                  hoverinfo = 'text',
                  hovertemplate = paste('<b>Name</b>: %{text}',
                                        '<br><b>Cost</b>: $%{x}',
                                        '<br><b>Completion Rate</b>: %{y}%',
                                        '<br><b>Enrollment</b>: %{marker.color}'),
                  text = ~University.Name) %>%
  plotly::layout(title = 'Cost vs Completion Rate (including Enrollment)', 
                    xaxis = list(title = 'Average Cost'), 
                    yaxis = list(title = 'Completion Rate')))
saveWidget(p, "visualizations/cost_enrollment_vs_completion.html", selfcontained = F, libdir = "lib")
orca(p, file = "visualizations/cost_enrollment_vs_completion.png")
```

Here is a different visual, but uses the same variables as above. Here the graph seems to indicate that as cost grows, the number of students drops and the completion rate rises. However, considering the distribution, there seems to be a second trend of schools where the cost increases far more gradually and the completion rate rises faster. These schools tend to have more students, but still attain a high graduation rate.

