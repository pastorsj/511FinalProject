---
title: "Statistical Analysis"
author: "Haley Roberts, Sam Pastoriza, Monroe Farris"
date: "12/05/2021"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

\pagenumbering{gobble}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
if (!require("pacman")) {
  install.packages("pacman")
}

pacman::p_load(caret, tidyverse)
```

## Linear Regression

##### Create training and testing data sets

```{r}
# Libraries
dataDF_14_15 = read.csv('data/school_statistics.csv')

# Set seed
set.seed(926)

# Create list of samples to include in training data set
train_samps <- dataDF_14_15$Comp.Rate.17_18.BIN %>% 
  createDataPartition(p = 0.8, list = FALSE)

# Create training data set
trainDF <- dataDF_14_15[train_samps, ]

# Create testing data set
testDF <- dataDF_14_15[-train_samps, ]
```


##### Model 1

```{r}
# Fit a multivariate regression model to predict completion rate
model_1 <- lm(Completion.Rate.17_18 ~ 
                #University.Name +
                #University.City +
                #University.State + 
                #Predominantly.Black +
                Admission.Rate + 
                SAT.Average + 
                SAT.Reading.Mid + 
                SAT.Math.Mid + 
                ACT.Cumulative.Average +
                Undergraduate.Enrollment +
                Average.Cost.per.Academic.Year + 
                In.State.Tuition.and.Fees + 
                Out.of.State.Tuition.and.Fees +
                #Completion.Rate..4.year.institutions +
                #Comp.Rate.17_18.BIN +
                Region,
                #Size,
              data = trainDF)
# View the results of the model
summary(model_1)
```

```{r}
# Make predictions on testing data set using Model 1
preds_1 <- predict(model_1, testDF)

# Consider model performance
# Prediction error (RMSE)
RMSE(preds_1, testDF$Completion.Rate.17_18)
# R-square ## R2{caret package}
R2(preds_1, testDF$Completion.Rate.17_18)
```


##### Model 2: Fit new model with only variables from model 1 with P < 0.25

```{r}
# Fit a multivariate regression model to predict completion rate
model_2 <- lm(Completion.Rate.17_18 ~ 
                #University.Name +
                #University.City +
                #University.State + 
                #Predominantly.Black +
                Admission.Rate + 
                SAT.Average + 
                ##SAT.Reading.Mid + 
                ##SAT.Math.Mid + 
                ACT.Cumulative.Average +
                Undergraduate.Enrollment +
                Average.Cost.per.Academic.Year + 
                ##In.State.Tuition.and.Fees + 
                Out.of.State.Tuition.and.Fees +
                #Completion.Rate..4.year.institutions +
                #Comp.Rate.17_18.BIN +
                Region,
                #Size,
              data = trainDF)
# View the results of the model
summary(model_2)
```

## Visualize variables

```{r}
level_rate <- factor(dataDF_14_15$Comp.Rate.17_18.BIN, level = c('Low', 'Medium', 'High'))

### Visualize: Admission Rate
dataDF_14_15 %>%
  ggplot( aes(x = level_rate, y = Admission.Rate, fill = level_rate)) +
  geom_boxplot() +
  ggtitle("Admission Rate vs Completion Rate") + 
  xlab('Completion Rate') + 
  ylab('Admissions Rate') + 
  labs(fill = "Completion Rate")
dev.copy(png, filename = 'visualizations/admissions_rate_per_completion_rate_category_boxplot.png', width = 800, height = 600)
dev.off()

### Visualize: SAT Average
# Create dataframe with no missing SAT Average data
dataDF_14_15_cleanSAT <- dataDF_14_15[!is.na(dataDF_14_15$SAT.Average),]
# Create graph
dataDF_14_15_cleanSAT %>%
  ggplot( aes(x = level_rate, y = SAT.Average, fill = level_rate)) +
  geom_boxplot() +
  ggtitle("Average SAT Score vs Completion Rate") + 
  xlab('Completion Rate') + 
  ylab('Average SAT Score') + 
  labs(fill = "Completion Rate")
dev.copy(png, filename = 'visualizations/sat_score_per_completion_rate_category_boxplot.png', width = 800, height = 600)
dev.off()

### Visualize: Undergrad Enrollment
# Create dataframe with no missing undergrad enrollment data
dataDF_14_15_cleanSize <- dataDF_14_15[!is.na(dataDF_14_15$Size),]
level_size <- factor(dataDF_14_15_cleanSize$Size, levels = c('Very Small', 'Small', 'Medium', 'Large', 'Very Large'))
# Version 1 - quantitative data
dataDF_14_15_cleanSize %>%
  ggplot( aes(x = level_rate, y = Undergraduate.Enrollment, fill = level_rate)) +
  geom_boxplot() +
  ggtitle("Undergrad Enrollment vs Completion Rate") + 
  xlab('Completion Rate') + 
  ylab('Undergraduate Enrollment') + 
  labs(fill = "Completion Rate")
dev.copy(png, filename = 'visualizations/size_per_completion_rate_category_boxplot.png', width = 800, height = 600)
dev.off()

# Version 2 - binned data
dataDF_14_15_cleanSize %>%
  ggplot( aes(fill = level_size, y = level_size, x = level_rate)) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("School Size vs Completion Rate") + 
  theme(axis.text.y = element_blank()) +
  xlab("Completion Rate") + 
  ylab('School Size') + 
  labs(fill = 'School Size')
dev.copy(png, filename = 'visualizations/size_per_completion_rate_category_bar_1.png', width = 800, height = 600)
dev.off()

# Version 3 - binned data
dataDF_14_15_cleanSize %>%
  ggplot( aes(fill = level_rate, y = level_rate, x = level_size)) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("School Size vs Completion Rate") + 
  theme(axis.text.y = element_blank()) +
  ylab("") +
  xlab('School Size') + 
  labs(fill = 'Completion Rate')
dev.copy(png, filename = 'visualizations/size_per_completion_rate_category_bar_2.png', width = 800, height = 600)
dev.off()

### Visualize: Average Cost per Academic Year
# Create dataframe with no missing Average Cost data
dataDF_14_15_cleanCost <- dataDF_14_15[!is.na(dataDF_14_15$Average.Cost.per.Academic.Year),]
# Create graph
dataDF_14_15_cleanCost %>%
  ggplot( aes(x = level_rate, y = Average.Cost.per.Academic.Year, fill = level_rate)) +
  geom_boxplot() +
  ggtitle("Average Cost/Year vs Completion Rate") + 
  xlab('Completion Rate') + 
  ylab('Average Cost/Year') + 
  labs(fill = "Completion Rate")
dev.copy(png, filename = 'visualizations/cost_per_completion_rate_category_boxplot.png', width = 800, height = 600)
dev.off()

### Visualize: Out of State Tuition & Fees
dataDF_14_15 %>%
  ggplot( aes(x = level_rate, y = Out.of.State.Tuition.and.Fees, fill = level_rate)) +
  geom_boxplot() +
  ggtitle("Out of State Costs vs Completion Rate") + 
  xlab('Completion Rate') + 
  ylab('Out of State Tuition & Fees') + 
  labs(fill = "Completion Rate")
dev.copy(png, filename = 'visualizations/out_of_state_cost_per_completion_rate_category_boxplot.png', width = 800, height = 600)
dev.off()

### Visualize: Regions
# Create dataframe with no missing regions
dataDF_14_15_cleanRegion <- dataDF_14_15[!is.na(dataDF_14_15$Region),]
# Version 1
dataDF_14_15_cleanRegion %>%
  ggplot( aes(fill = Region, y = Region, x = level_rate)) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("Region vs Completion Rate") + 
  theme(axis.text.y = element_blank()) +
  xlab("Completion Rate")
dev.copy(png, filename = 'visualizations/region_per_completion_rate_category_bar_1.png', width = 800, height = 600)
dev.off()

# Version 2
dataDF_14_15_cleanRegion %>%
  ggplot( aes(fill = level_rate, y = level_rate, x = Region)) + 
  geom_bar(position="stack", stat="identity") +
  ggtitle("Region vs Completion Rate") + 
  theme(axis.text.y = element_blank()) +
  ylab("") + 
  labs(fill = 'Completion Rate')
dev.copy(png, filename = 'visualizations/region_per_completion_rate_category_bar_2.png', width = 800, height = 600)
dev.off()
```

## Hypothesis Testing

### Chi-Square Test for Independence

##### Region vs Completion Rate

$H_0:$ Region and completion rates are independent. Completion Rates do not vary by region.
$H_a:$ Region and completion rates are dependent. Completion Rates do vary by region.

```{r}
# Create two-way table for region vs completion rate
(A <- table(dataDF_14_15_cleanRegion$Size, dataDF_14_15_cleanRegion$Comp.Rate.17_18.BIN))

# Run a Chi-Square test
chisq.test(A)
```

Since the p-value is very small (< 0.05), at the 5% significance level there is enough evidence to reject the null hypothesis. Thus, region and completion rate are dependent, i.e. there is a significant relationship between completion rate and region.

##### School Size vs Completion Rate

$H_0:$ School size and completion rates are independent. Completion Rates do not vary by school size.
$H_a:$ School size and completion rates are dependent. Completion Rates do vary by school size.

```{r}
# Create two-way table for school size vs completion rate
(B <- table(dataDF_14_15_cleanSize$Size, dataDF_14_15_cleanSize$Comp.Rate.17_18.BIN))

# Run a Chi-Square test
chisq.test(B)
```

Since the p-value is very small (< 0.05), at the 5% significance level there is enough evidence to reject the null hypothesis. Thus, school size and completion rate are dependent, i.e. there is a significant relationship between completion rate and school size.

### T-Tests

##### SAT Average and Completion Rate

```{r}
# Subset data into the three completion rate categories
lowDF_SAT <- subset(dataDF_14_15_cleanSAT, Comp.Rate.17_18.BIN == "Low", select=c(SAT.Average))
medDF_SAT <- subset(dataDF_14_15_cleanSAT, Comp.Rate.17_18.BIN == "Medium", select=c(SAT.Average))
highDF_SAT <- subset(dataDF_14_15_cleanSAT, Comp.Rate.17_18.BIN == "High", select=c(SAT.Average))
```

*Comparing Low & Medium Completion Rates*
$H_0:$ The mean SAT Averages of Low-Completion Rate universities and Medium-Completion Rate universities are the same, $\mu_{low}=\mu_{medium} \implies \mu_{low}-\mu_{medium} =0$
$H_a:$ The mean SAT Averages of Low-Completion Rate universities and Medium-Completion Rate universities are not the same, $\mu_{low}\neq \mu_{medium}$

```{r}
t.test(lowDF_SAT$SAT.Average, medDF_SAT$SAT.Average)
```

Since the p-value is very small (<0.05), at the 5% significance level there is enough evidence to reject the null hypothesis, indicating there is a significant difference in the mean SAT scores between low completion rate and medium completion rate.


*Comparing Medium & High Completion Rates*
$H_0:$ The mean SAT Averages of Medium-Completion Rate universities and High-Completion Rate universities are the same, $\mu_{medium}=\mu_{high} \implies \mu_{medium}-\mu_{high} =0$
$H_a:$ The mean SAT Averages of Medium-Completion Rate universities and High-Completion Rate universities are not the same, $\mu_{medium}\neq \mu_{high}$

```{r}
t.test(medDF_SAT$SAT.Average, highDF_SAT$SAT.Average)
```

Since the p-value is very small (<0.05), at the 5% significance level there is enough evidence to reject the null hypothesis, indicating there is a significant difference in the mean SAT scores between medium completion rate and high completion rate.

##### Average Cost per Academic Year and Completion Rate

```{r}
# Subset data into the three completion rate categories
lowDF_Cost <- subset(dataDF_14_15_cleanCost, Comp.Rate.17_18.BIN == "Low", select=c(Average.Cost.per.Academic.Year))
medDF_Cost <- subset(dataDF_14_15_cleanCost, Comp.Rate.17_18.BIN == "Medium", select=c(Average.Cost.per.Academic.Year))
highDF_Cost <- subset(dataDF_14_15_cleanCost, Comp.Rate.17_18.BIN == "High", select=c(Average.Cost.per.Academic.Year))
```

*Comparing Low & Medium Completion Rates*
$H_0:$ The mean Cost of Low-Completion Rate universities and Medium-Completion Rate universities are the same, $\mu_{low}=\mu_{medium} \implies \mu_{low}-\mu_{medium} =0$
$H_a:$ The mean Cost of Low-Completion Rate universities and Medium-Completion Rate universities are not the same, $\mu_{low}\neq \mu_{medium}$

```{r}
t.test(lowDF_Cost$Average.Cost.per.Academic.Year, medDF_SAT$Average.Cost.per.Academic.Year)
```

Since the p-value is very small (<0.05), at the 5% significance level there is enough evidence to reject the null hypothesis, indicating there is a significant difference in the mean average costs between low completion rate and medium completion rate.


*Comparing Medium & High Completion Rates*
$H_0:$ The mean Cost of Medium-Completion Rate universities and High-Completion Rate universities are the same, $\mu_{medium}=\mu_{high} \implies \mu_{medium}-\mu_{high} =0$
$H_a:$ The mean Cost of Medium-Completion Rate universities and High-Completion Rate universities are not the same, $\mu_{medium}\neq \mu_{high}$

```{r}
t.test(medDF_Cost$Average.Cost.per.Academic.Year, highDF_Cost$Average.Cost.per.Academic.Year)
```

Since the p-value is very small (<0.05), at the 5% significance level there is enough evidence to reject the null hypothesis, indicating there is a significant difference in the mean average costs between medium completion rate and high completion rate.
